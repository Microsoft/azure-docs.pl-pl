---
title: Ocena luk w zabezpieczeniach SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Dowiedz się, jak skonfigurować ocenę luk w zabezpieczeniach SQL i interpretować raporty oceny dotyczące Azure SQL Database, wystąpienia zarządzanego usługi Azure SQL i usługi Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/19/2021
ms.locfileid: "100376647"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Ocena luk w zabezpieczeniach SQL pomaga identyfikować luki w zabezpieczeniach bazy danych
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Ocena luk w zabezpieczeniach programu SQL to prosta w konfiguracji usługa, która umożliwia odnajdywanie, śledzenie i rozwiązywanie problemów z potencjalnymi lukami w zabezpieczeniach bazy danych. Dzięki niej można aktywnie zwiększać poziom bezpieczeństwa bazy danych.

Ocena luk w zabezpieczeniach jest częścią [usługi Azure Defender dla oferty SQL](azure-defender-for-sql.md) , która jest ujednoliconym pakietem zaawansowanych funkcji zabezpieczeń SQL. Dostęp do oceny luk w zabezpieczeniach można uzyskać i zarządzać nim za pośrednictwem centralnej usługi Azure Defender dla programu SQL Portal.

> [!NOTE]
> Ocena luk w zabezpieczeniach jest obsługiwana w przypadku Azure SQL Database, wystąpienia zarządzanego usługi Azure SQL i usługi Azure Synapse Analytics. Bazy danych w Azure SQL Database, wystąpienie zarządzane usługi Azure SQL i usługa Azure Synapse Analytics są określane zbiorczo w pozostałej części tego artykułu jako bazy danych, a serwer odwołuje się do [serwera](logical-servers.md) , który obsługuje bazy danych dla Azure SQL Database i Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>Co to jest ocena luk w zabezpieczeniach SQL?

Ocena luk w zabezpieczeniach w programie SQL to usługa, która zapewnia wgląd w stan zabezpieczeń. Ocena luk w zabezpieczeniach obejmuje kroki umożliwiające rozwiązywanie problemów z zabezpieczeniami i zwiększanie bezpieczeństwa bazy danych. Może on ułatwić monitorowanie dynamicznego środowiska bazy danych, w którym zmiany są trudne do śledzenia i ulepszania stan zabezpieczeń SQL.

Ocena luk w zabezpieczeniach to usługa skanowania wbudowana w Azure SQL Database. Usługa korzysta z bazy wiedzy o regułach, które flagą luki w zabezpieczeniach. Wyróżniają one odchylenia od najlepszych rozwiązań, takich jak niezmienione konfiguracje, nadmierne uprawnienia i niechronione dane poufne.

Zasady są oparte na najlepszych rozwiązaniach firmy Microsoft i koncentrują się na problemach z bezpieczeństwem, które stanowią największe ryzyko dla bazy danych i jej cennych danych. Obejmują one problemy na poziomie bazy danych i problemy z zabezpieczeniami na poziomie serwera, takie jak ustawienia zapory serwera i uprawnienia na poziomie serwera.

Wyniki skanowania obejmują kroki umożliwiające rozwiązanie problemu i zapewniają dostosowane skrypty korygowania, jeśli ma to zastosowanie. Możesz dostosować raport oceny dla swojego środowiska, ustawiając akceptowalną linię bazową dla:

- Konfiguracje uprawnień
- Konfiguracje funkcji
- Ustawienia bazy danych

## <a name="configure-vulnerability-assessment"></a>Konfigurowanie oceny luk w zabezpieczeniach

Wykonaj następujące kroki, aby skonfigurować ocenę luk w zabezpieczeniach:

1. W [Azure Portal](https://portal.azure.com)Otwórz konkretny zasób w Azure SQL Database, bazie danych wystąpienia zarządzanego SQL lub Azure Synapse.

1. W obszarze nagłówek **zabezpieczeń** wybierz pozycję **Security Center**.

1. Wybierz pozycję **Konfiguruj** na linku, aby otworzyć okienko ustawienia usługi Azure Defender dla programu SQL dla całego serwera lub wystąpienia zarządzanego.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Otwieranie usługi Defender dla konfiguracji SQL":::

    > [!NOTE]
    > Ocena luk w zabezpieczeniach SQL wymaga, aby **usługa Azure Defender dla programu SQL Server** mogła uruchamiać skany. Aby uzyskać więcej informacji na temat włączania usługi Azure Defender dla programu SQL, zobacz [usługa Azure Defender dla języka SQL](azure-defender-for-sql.md).

1. Na stronie **Ustawienia serwera** Zdefiniuj ustawienia usługi Azure Defender dla programu SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Konfigurowanie skanowania w celu oceny luk w zabezpieczeniach SQL":::

    1. Skonfiguruj konto magazynu, w którym będą przechowywane wyniki skanowania dla wszystkich baz danych na serwerze lub w zarządzanym wystąpieniu. Informacje o kontach magazynu znajdują się w temacie [Informacje o kontach usługi Azure Storage](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Aby uzyskać więcej informacji o przechowywaniu skanów oceny luk w zabezpieczeniach za zaporami i sieci wirtualnych, zobacz temat Omówienie skanowania w celu przeprowadzenia [oceny luk w zabezpieczeniach, które są dostępne za zaporami i sieci wirtualnych](sql-database-vulnerability-assessment-storage.md).

    1. Aby skonfigurować oceny luk w zabezpieczeniach, aby automatycznie uruchamiać cotygodniowe skanowania w celu wykrywania błędnych konfiguracji zabezpieczeń, ustaw **okresowe skanowanie cykliczne** na **włączone**. Wyniki są wysyłane na adresy e-mail, które podano w polu **Wyślij raporty skanowania do**. Możesz również wysyłać powiadomienia e-mail do administratorów i właścicieli subskrypcji, włączając **także wysyłanie powiadomień pocztą e-mail do administratorów i właścicieli subskrypcji**.

1. Skanowanie w celu oceny luk w zabezpieczeniach programu SQL można również uruchomić na żądanie:

    1. Na stronie **Security Center** zasobu wybierz pozycję **Wyświetl dodatkowe wnioski w ocenie luk w zabezpieczeniach** , aby uzyskać dostęp do wyników skanowania przed poprzednimi skanami.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Otwieranie wyników skanowania i opcji skanowania ręcznego":::

    1. Aby uruchomić skanowanie na żądanie w celu przeskanowania bazy danych pod kątem luk w zabezpieczeniach, wybierz opcję **Skanuj** z poziomu paska narzędzi:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Wybierz opcję Skanuj, aby uruchomić skanowanie oceny luk w zabezpieczeniach na żądanie dla zasobu SQL":::


  > [!NOTE]
  > Skanowanie jest lekkie i bezpieczne. Uruchomienie programu może zająć kilka sekund i jest tylko do odczytu. Nie wprowadza żadnych zmian w bazie danych.

## <a name="remediate-vulnerabilities"></a>Korygowanie luk w zabezpieczeniach

Po zakończeniu skanowania w poszukiwaniu luk w zabezpieczeniach raport zostanie wyświetlony w Azure Portal. Raport przedstawia:

- Przegląd stanu zabezpieczeń
- Liczba znalezionych problemów i
- Podsumowanie według ważności ryzyka
- Lista wyników do dalszych badań

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Raport skanowania Sampl w programie SQL Server w ramach programu oceny luk w zabezpieczeniach":::

Aby skorygować wykryte luki w zabezpieczeniach:

1. Przejrzyj wyniki i ustal, które z ocen raportu są prawdziwe problemy z bezpieczeństwem środowiska.

1. Wybierz każdy wynik niepowodzenia, aby zrozumieć jego wpływ i dlaczego sprawdzanie zabezpieczeń nie powiodło się.

    > [!TIP]
    > Na stronie Szczegóły ustaleń znajdują się informacje o korygowaniu akcji objaśniające, jak rozwiązać problem.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Badanie wyników skanowania w poszukiwaniu luk w zabezpieczeniach":::

1. Podczas przeglądania wyników oceny można oznaczyć określone wyniki jako akceptowalną *linię bazową* w środowisku. Linia bazowa polega głównie na dostosowywaniu sposobu zgłaszania wyników. W kolejnych skanach wyniki pasujące do linii bazowej są traktowane jako przebiegi. Po ustaleniu stanu zabezpieczeń linii bazowej oceny luk w zabezpieczeniach są raportowane wyłącznie od linii bazowej. Dzięki temu można skoncentrować się na istotnych problemach.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Zatwierdzanie wyszukiwania jako podstawy do przyszłych operacji skanowania":::

1. Jeśli zmienisz linie bazowe, użyj przycisku **Skanuj** , aby uruchomić skanowanie na żądanie i wyświetlić dostosowany raport. Wszystkie ustalenia, które zostały dodane do linii bazowej, będą teraz wyświetlane w **przekazaniu** ze wskazaniem, że zostały przesłane ze względu na zmiany linii bazowej.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Przeszedł oceny wskazujące, że zostały przesłane na niestandardową linię bazową":::

Skanowanie w celu oceny luk w zabezpieczeniach może być teraz używane do zapewnienia wysokiego poziomu zabezpieczeń i spełnienia zasad organizacji. 

## <a name="advanced-capabilities"></a>Zaawansowane możliwości

### <a name="export-an-assessment-report"></a>Wyeksportuj raport dotyczący oceny

Wybierz pozycję **Eksportuj wyniki skanowania** , aby utworzyć raport programu Excel do pobrania dla wyniku skanowania. Ten raport zawiera kartę Podsumowanie, na której jest wyświetlane podsumowanie oceny. Raport zawiera wszystkie testy zakończone niepowodzeniem. Zawiera również kartę **wyników** , która zawiera pełen zestaw wyników skanowania. Wyniki obejmują wszystkie testy, które zostały uruchomione, oraz szczegóły wyników dla każdego z nich.

### <a name="view-scan-history"></a>Wyświetl historię skanowania

Wybierz pozycję **historia skanowania** w okienku Ocena luk w zabezpieczeniach, aby wyświetlić historię wszystkich skanów uruchomionych wcześniej w tej bazie danych. Wybierz konkretne skanowanie na liście, aby wyświetlić szczegółowe wyniki tego skanowania.

## <a name="manage-vulnerability-assessments-programmatically"></a>Programowe zarządzanie ocenami luk w zabezpieczeniach

### <a name="using-azure-powershell"></a>Korzystanie z programu Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Moduł Azure Resource Manager programu PowerShell jest nadal obsługiwany, ale wszystkie przyszłe Programowanie dla modułu AZ. SQL. W przypadku tych poleceń cmdlet zobacz [AzureRM. SQL](/powershell/module/AzureRM.Sql/). Argumenty poleceń polecenia AZ module i w modułach AzureRm są zasadniczo identyczne.

Za pomocą poleceń cmdlet Azure PowerShell można programowo zarządzać ocenami luk w zabezpieczeniach. Obsługiwane polecenia cmdlet są następujące:

| Nazwa polecenia cmdlet jako linku | Opis |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Czyści linię bazową reguły oceny luk w zabezpieczeniach.<br/>Najpierw należy ustawić linię bazową przed użyciem tego polecenia cmdlet, aby usunąć jego zaznaczenie. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Czyści ustawienia oceny luk w zabezpieczeniach bazy danych. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Czyści linię bazową reguły oceny luk w zabezpieczeniach w zarządzanej bazie danych.<br/>Najpierw należy ustawić linię bazową przed użyciem tego polecenia cmdlet, aby usunąć jego zaznaczenie. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Czyści ustawienia oceny luk w zabezpieczeniach zarządzanej bazy danych. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Czyści ustawienia oceny luk w zabezpieczeniach wystąpienia zarządzanego. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Konwertuje wyniki skanowania oceny luk w zabezpieczeniach bazy danych do pliku programu Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Konwertuje wyniki skanowania oceny luk w zabezpieczeniach z zarządzanej bazy danych do pliku programu Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Pobiera linię bazową reguły oceny luk w zabezpieczeniach bazy danych dla danej reguły. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Pobiera linię bazową reguły oceny luk w zabezpieczeniach dla zarządzanej bazy danych dla danej reguły. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Pobiera wszystkie rekordy skanowania oceny luk w zabezpieczeniach skojarzone z daną bazą danych. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Pobiera wszystkie rekordy skanowania oceny luk w zabezpieczeniach skojarzone z daną zarządzaną bazą danych. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Zwraca ustawienia oceny luk w zabezpieczeniach bazy danych. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Zwraca ustawienia oceny luk w zabezpieczeniach zarządzanej bazy danych. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Ustawia linię bazową reguły oceny luk w zabezpieczeniach. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Ustawia linię bazową reguły oceny luk w zabezpieczeniach dla zarządzanej bazy danych. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Wyzwala rozpoczęcie skanowania oceny luk w zabezpieczeniach w bazie danych. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Wyzwala rozpoczęcie skanowania oceny luk w zabezpieczeniach na zarządzanej bazie danych. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Aktualizuje ustawienia oceny luk w zabezpieczeniach bazy danych. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Aktualizuje ustawienia oceny luk w zabezpieczeniach zarządzanej bazy danych. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Aktualizuje ustawienia oceny luk w zabezpieczeniach wystąpienia zarządzanego. |
| &nbsp; | &nbsp; |

Aby zapoznać się z przykładem skryptu, zobacz temat [Obsługa programu PowerShell w usłudze Azure SQL](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Korzystanie z szablonów usługi Resource Manager

Aby skonfigurować podstawy oceny luk w zabezpieczeniach przy użyciu szablonów Azure Resource Manager, należy użyć `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` typu.

`vulnerabilityAssessments`Przed dodaniem linii bazowych upewnij się, że zostały włączone.

Oto przykład definiowania reguły linii bazowej VA2065 do `master` bazy danych i VA1143 do `user` bazy danych jako zasoby w Menedżer zasobów szablonu:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

W przypadku `master` baz danych i `user` baz danych nazwy zasobów są zdefiniowane inaczej:

- Baza danych Master — "name": "[concat (Parameters (" server_name "),"/", Parameters (" database_name "),"/default/VA2065/<b>Master</b>")]",
- Baza danych użytkownika — "name": "[concat (Parameters (" server_name "),"/", Parameters (" database_name "),"/default/VA2065/<b>default</b>")]",

Aby obsłużyć typy logiczne jako PRAWDA/FAŁSZ, ustaw wynik linii bazowej z danymi binarnymi, takimi jak "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Następne kroki  

- Dowiedz się więcej o [usłudze Azure Defender dla języka SQL](azure-defender-for-sql.md).
- Dowiedz się więcej na temat [odnajdywania i klasyfikowania danych](data-discovery-and-classification-overview.md).
- Dowiedz się więcej na temat [przechowywania oceny luk w zabezpieczeniach — wyniki skanowania są dostępne dla zapór i sieci wirtualnych](sql-database-vulnerability-assessment-storage.md).